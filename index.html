<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –°–æ–ª—è—Ä–∞</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        *, *::before, *::after {
          box-sizing: border-box;
        }
      </style>
</head>
<body>
    <div class="container">
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –°–æ–ª—è—Ä–∞</h1>
      
        <div class="input-group">
            <label>–ò–º—è:</label>
            <input type="text" id="userName" required>
        </div>
      
        <div class="input-group">
            <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è (–º–µ—Å—Ç–Ω–æ–µ):</label>
            <input type="datetime-local" id="birthDateTime" required>
        </div>
      
        <div class="input-group">
            <label>–ì–æ–¥ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –°–æ–ª—è—Ä–∞:</label>
            <input type="number" id="targetYear" min="1900" max="2100" required>
        </div>
      
        <div class="input-group">
            <label>–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è (–≥–æ—Ä–æ–¥):</label>
            <input type="text" id="birthCity" required>
        </div>
      
        <div class="input-group">
            <label>–ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è (–≥–æ—Ä–æ–¥):</label>
            <input type="text" id="residenceCity" required>
        </div>
      
        <button id="calculateBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
      
        <div id="result" class="result" style="display: none;"></div>
        <div id="error" class="error" style="display: none;"></div>
      </div>      

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tg = window.Telegram.WebApp;
      tg.expand();
      if (tg.colorScheme === "dark") {
        document.body.classList.add("dark-theme");
      }
    });

    document.getElementById('calculateBtn').addEventListener('click', () => {
      const tg = window.Telegram.WebApp;

      const data = {
        action: "calculate",
        userName:      document.getElementById('userName').value.trim(),
        birthDateTime: document.getElementById('birthDateTime').value,
        targetYear:    parseInt(document.getElementById('targetYear').value),
        birthCity:     document.getElementById('birthCity').value.trim(),
        residenceCity: document.getElementById('residenceCity').value.trim(),
        userId:        tg.initDataUnsafe?.user?.id
      };

      if (!data.userName || !data.birthDateTime || !data.targetYear || !data.birthCity || !data.residenceCity) {
        const errEl = document.getElementById('error');
        errEl.textContent = "‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è";
        errEl.classList.add("show");
        return;
      }

      // üì® –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
      tg.sendData(JSON.stringify(data));

      // ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º WebApp ‚Äî –∏–Ω–∞—á–µ update –Ω–µ –¥–æ–π–¥—ë—Ç!
      tg.close();
    });
  </script>
</body>
</html>
